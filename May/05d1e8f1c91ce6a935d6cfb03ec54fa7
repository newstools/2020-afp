The Saudi military student who killed three Americans at a US naval base in December had longstanding ties to Al-Qaeda and planned an attack before he arrived in the United States, US justice officials said Monday. The December 6 attack by Mohammed Alshamrani, a Royal Saudi Air Force flight student at the Naval Air Station Pensacola in Florida, "was actually the culmination of years of planning and preparation," said FBI Director Christopher Wray. Evidence discovered on an encrypted cell phone shows he was radicalized at least as far back as 2015, and had since been associating with "dangerous" operatives from the Yemen-based Al-Qaeda in the Arabian Peninsula (AQAP), Wray added. The FBI and Justice Department revealed their findings after a months-long effort to crack the encryption on Alshamrani's iPhone, which they said Apple refused to help with. US Attorney General Bill Barr accused Apple of putting its own financial interests ahead of the nation's. "If not for our FBI's ingenuity, some luck, and hours upon hours of time and resources, this information would have remained undiscovered," Barr said. "The bottom line: our national security cannot remain in the hands of big corporations who put dollars over lawful access and public safety. The time has come for a legislative solution," he said. Apple rejected suggestions that it did not cooperate in the investigation. But the company also said that creating a so-called "back door" into its phones for US law enforcement would make them vulnerable for a wide range of hackers. "There is no such thing as a back door just for the good guys, and the American people do not have to choose between weakening encryption and effective investigations," Apple said in a statement. - Discussed plans and tactics - Wray said the 21-year-old Saudi had expressed a desire to learn to fly years ago with plans for a "special operation," enlisting in the Royal Saudi Air Force and joining flight training in the United States. "In the months before the attack, while he was here among us, he talked with AQAP about his plans and tactics -- taking advantage of the information he acquired here, to assess how many people he could try to kill," Wray said. He was in touch with AQAP contacts the night before he launched the attack, Wray added. The December 6 shooting in a classroom building at the naval base left three US sailors dead and wounded eight other people, including two responding sheriff's deputies, before Alshamrani was killed by police. AQAP claimed responsibility, but at the time there was no evidence of a direct link. The incident forced the temporary freeze of all US training for foreign military officials in order to review security precautions. The decades-old US-Saudi training program has been crucial to the countries' close relationship, with thousands of Saudis undergoing military training in the United States. The US expelled 21 of Alshamrani's classmates for reasons including that some had allegedly been aware of his radical leanings and others possessed jihadist material and child pornography. The program has since resumed, but with heavier vetting of Saudi students and a ban on their accessing firearms. - Continuing Qaeda threat - The December attack indicated that, far from being eliminated with the killing of founder Osama Bin Laden in 2011, Al-Qaeda remains a potent threat, able to project its menace beyond the Middle East, according to experts. If it was in fact directed by AQAP, Alshamrani's attack would be the first successful Al-Qaeda-organized assault on the United States since the September 11, 2001 attacks, said David Sterman, a senior policy analyst at the New America think tank. All the successful attacks in the country since then have been organized locally by people inspired or encouraged by Al-Qaeda and the Islamic State group, but not organized by them. "Is this the sign of an existing external plotting capability in Yemen that continues?" Sterman asked. Even so, he noted: "One deadly foreign-directed attack in 19 years is a relatively high level of success for the US." The Saudi Embassy in Washington issued a statement expressing its condolences to the American people over the attack in Florida and welcoming word that "critical intelligence" was recovered from Alshamrani's telephones.